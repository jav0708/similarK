# ç›¸ä¼¼Kçº¿å¯»æ‰¾

## é¡¹ç›®æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®ä¸“æ³¨äºä»Aè‚¡å¸‚åœºå†å²æ•°æ®ä¸­é€šè¿‡**Ranked KLineï¼ˆæ’åºKçº¿ï¼‰ç®—æ³•**æ¥å¯»æ‰¾ç›¸ä¼¼çš„Kçº¿æ¨¡å¼ï¼Œå¹¶ç»Ÿè®¡ä¸åŒæ’åºç»„åˆçš„å‡ºç°é¢‘ç‡åŠå…¶å¯¹åº”çš„æœªæ¥æ”¶ç›Šç‡ã€‚é€šè¿‡å¯¹æ—¶é—´çª—å£å†…å¼€é«˜æ”¶ä½ä»·æ ¼çš„æ’åºåˆ†æï¼Œè¯†åˆ«å…·æœ‰ç»Ÿè®¡æ˜¾è‘—æ€§çš„Kçº¿æ¨¡å¼ã€‚

**æ ¸å¿ƒç‰¹æ€§**ï¼š
- âš¡ **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¤šæ ¸CPUå¹¶è¡Œè®¡ç®—ï¼Œæ˜¾è‘—æå‡åˆ†æé€Ÿåº¦
- ğŸ—œï¸ **æ¨¡å¼åˆ†ç»„**ï¼šæ™ºèƒ½åˆå¹¶ç›¸ä¼¼æ¨¡å¼ï¼Œå¤§å¹…å‡å°‘è¾“å‡ºæ–‡ä»¶å¤§å°ï¼ˆ90%+å‹ç¼©ç‡ï¼‰
- ğŸ“Š **å¤§è§„æ¨¡åˆ†æ**ï¼šæ”¯æŒå¤„ç†å¤§çª—å£é•¿åº¦å’Œæ‰¹é‡è‚¡ç¥¨æ•°æ®
- ğŸ¯ **é«˜ç²¾åº¦ç®—æ³•**ï¼šä¿®å¤çš„ç›¸ä¼¼æ€§ç®—æ³•ç¡®ä¿åˆ†ç»„ç»“æœå‡†ç¡®å¯é 

## é¡¹ç›®ç›®æ ‡

- è¯†åˆ«å…·æœ‰é¢„æµ‹ä»·å€¼çš„Kçº¿æ¨¡å¼
- ç»Ÿè®¡ä¸åŒæ¨¡å¼å¯¹åº”çš„æœªæ¥æ”¶ç›Šç‡åˆ†å¸ƒ
- æä¾›å¯é…ç½®çš„æ—¶é—´çª—å£å’Œé¢„æµ‹å‘¨æœŸ
- æ”¯æŒå¤§è§„æ¨¡æ•°æ®æ‰¹é‡å¤„ç†
- æä¾›é«˜æ€§èƒ½å¹¶è¡Œè®¡ç®—è§£å†³æ–¹æ¡ˆ
- å®ç°æ™ºèƒ½æ¨¡å¼å‹ç¼©ï¼Œå¤„ç†è¶…å¤§æ•°æ®é›†


## å¤„ç†æ¨¡å¼

æœ¬é¡¹ç›®æ”¯æŒä¸¤ç§æ•°æ®å¤„ç†æ¨¡å¼ï¼š

### æ¨¡å¼ä¸€ï¼šæ‰¹é‡å¤„ç†ï¼ˆå…¨å¸‚åœºåˆ†æï¼‰
- **åŠŸèƒ½**: è¯»å–æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰è‚¡ç¥¨çš„å†å²æ•°æ®
- **ç”¨é€”**: è¿›è¡Œå…¨å¸‚åœºKçº¿æ¨¡å¼çš„ç»Ÿè®¡åˆ†æ
- **è¾“å‡º**: ç”ŸæˆåŒ…å«æ‰€æœ‰è‚¡ç¥¨æ•°æ®çš„ç»¼åˆç»Ÿè®¡æŠ¥å‘Š
- **é€‚ç”¨åœºæ™¯**: å¯»æ‰¾å¸‚åœºæ™®éå­˜åœ¨çš„Kçº¿æ¨¡å¼è§„å¾‹

**ç‰¹ç‚¹**:
- å¤„ç†å¤§é‡è‚¡ç¥¨æ•°æ®ï¼Œæ ·æœ¬å®¹é‡å¤§
- ç»Ÿè®¡ç»“æœæ›´å…·æ™®éæ€§å’Œç¨³å®šæ€§
- èƒ½å‘ç°è·¨è‚¡ç¥¨çš„å…±åŒæ¨¡å¼
- è®¡ç®—èµ„æºéœ€æ±‚è¾ƒé«˜

### æ¨¡å¼äºŒï¼šå•è‚¡åˆ†æï¼ˆä¸ªè‚¡ä¸“é¡¹åˆ†æï¼‰
- **åŠŸèƒ½**: é’ˆå¯¹æŒ‡å®šçš„å•åªè‚¡ç¥¨è¿›è¡Œæ·±åº¦åˆ†æ
- **ç”¨é€”**: åˆ†æç‰¹å®šè‚¡ç¥¨çš„ä¸ªæ€§åŒ–Kçº¿æ¨¡å¼
- **è¾“å‡º**: ç”Ÿæˆè¯¥è‚¡ç¥¨ä¸“å±çš„æ¨¡å¼ç»Ÿè®¡æŠ¥å‘Š
- **é€‚ç”¨åœºæ™¯**: å¯¹ç‰¹å®šè‚¡ç¥¨è¿›è¡Œç²¾å‡†çš„é‡åŒ–åˆ†æ

**ç‰¹ç‚¹**:
- ä¸“æ³¨å•åªè‚¡ç¥¨ï¼Œåˆ†ææ›´ç²¾ç»†
- èƒ½å‘ç°ä¸ªè‚¡ç‰¹æœ‰çš„æ¨¡å¼ç‰¹å¾
- è®¡ç®—é€Ÿåº¦å¿«ï¼Œèµ„æºæ¶ˆè€—å°‘
- é€‚åˆå®æ—¶äº¤æ˜“å†³ç­–æ”¯æŒ

## æŠ€æœ¯æ ˆ

- **Python 3.8+**: æ ¸å¿ƒå¼€å‘è¯­è¨€
- **pandas>=1.5.0**: æ•°æ®å¤„ç†å’Œåˆ†æ
- **numpy>=1.21.0**: æ•°å€¼è®¡ç®—å’Œæ’åºç®—æ³•
- **scipy>=1.9.0**: ç»Ÿè®¡è®¡ç®—å’Œç›¸ä¼¼æ€§åˆ†æ
- **multiprocessing**: å¹¶è¡Œå¤„ç†æ¡†æ¶
- **matplotlib>=3.5.0**: å¯é€‰çš„æ•°æ®å¯è§†åŒ–æ”¯æŒ

## å®‰è£…å’Œä½¿ç”¨

### å®‰è£…æ­¥éª¤

1. è¿›å…¥é¡¹ç›®ç›®å½•
```bash
cd similar_K
```

2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–è€… venv\Scripts\activate  # Windows
```

3. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### å¿«é€Ÿå¼€å§‹

#### 1. æ•°æ®å‡†å¤‡
å°†Kçº¿æ•°æ®æ–‡ä»¶æ”¾å…¥ `data_example/` ç›®å½•ï¼š
- æ¯ä¸ªCSVæ–‡ä»¶åŒ…å«ä¸€åªè‚¡ç¥¨çš„å®Œæ•´å†å²æ•°æ®
- æ”¯æŒä¸­æ–‡åˆ—åæ ¼å¼ï¼ˆè‚¡ç¥¨ä»£ç ã€è‚¡ç¥¨ç®€ç§°ã€äº¤æ˜“æ—¥æœŸã€å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·ç­‰ï¼‰
- æ–‡ä»¶å‘½åæ ¼å¼ï¼š`{è‚¡ç¥¨ä»£ç }.csv`

#### 2. å•è‚¡å¼€ç›˜ä»·åˆ†æï¼ˆæ¨èå…¥é—¨ï¼‰
```bash
# åˆ†æå•åªè‚¡ç¥¨å¼€ç›˜ä»·çš„5æ—¥çª—å£æ’åºæ¨¡å¼
python main.py --mode single --stock_file data_example/sh600082.csv --price_type open -w 5
```

#### 3. æ‰¹é‡åˆ†æï¼ˆå¸‚åœºçº§åˆ«ï¼‰
```bash
# åˆ†ææ•´ä¸ªæ–‡ä»¶å¤¹ä¸­æ‰€æœ‰è‚¡ç¥¨çš„æ”¶ç›˜ä»·æ¨¡å¼
python main.py --mode batch --data_dir data_example/ --price_type close -w 5
```

#### 4. æŸ¥çœ‹ç»“æœ
ç»“æœå°†ä¿å­˜åœ¨ `output/` ç›®å½•ä¸‹ï¼š
- **å•è‚¡åˆ†æ**: `output/single_stock/{è‚¡ç¥¨ä»£ç }_{ä»·æ ¼ç±»å‹}_w{çª—å£}.csv`
- **æ‰¹é‡åˆ†æ**: `output/market/market_{ä»·æ ¼ç±»å‹}_w{çª—å£}.csv`

## APIæ–‡æ¡£

### å‘½ä»¤è¡Œå‚æ•°

#### æ¨¡å¼ä¸€ï¼šæ‰¹é‡å¤„ç†ï¼ˆå…¨å¸‚åœºåˆ†æï¼‰
```bash
python main.py --mode batch --data_dir [æ•°æ®æ–‡ä»¶å¤¹è·¯å¾„] [å…¶ä»–å‚æ•°]
```

#### æ¨¡å¼äºŒï¼šå•è‚¡åˆ†æï¼ˆä¸ªè‚¡ä¸“é¡¹åˆ†æï¼‰
```bash
python main.py --mode single --stock_file [å•ä¸ªè‚¡ç¥¨æ–‡ä»¶è·¯å¾„] [å…¶ä»–å‚æ•°]
```

#### æ ¸å¿ƒå‚æ•°

- `--mode`: å¤„ç†æ¨¡å¼ (batch/single, å¿…é€‰)
- `--data_dir`: æ•°æ®æ–‡ä»¶å¤¹è·¯å¾„ (batchæ¨¡å¼å¿…é€‰)
- `--stock_file`: å•ä¸ªè‚¡ç¥¨æ–‡ä»¶è·¯å¾„ (singleæ¨¡å¼å¿…é€‰)
- `--price_type, -p`: ä»·æ ¼ç±»å‹ (open/high/low/close, å¿…é€‰)
- `--window, -w`: æ—¶é—´çª—å£é•¿åº¦ (å¿…é€‰)
- `--output_dir, -o`: è¾“å‡ºç›®å½• (é»˜è®¤: output/)
- `--min_frequency`: æœ€å°æ¨¡å¼é¢‘ç‡é˜ˆå€¼ (é»˜è®¤: 10)
- `--verbose, -v`: è¯¦ç»†è¾“å‡ºæ¨¡å¼

#### æ€§èƒ½ä¼˜åŒ–å‚æ•°

- `--n_jobs, -j`: å¹¶è¡Œå¤„ç†æ•°é‡ (é»˜è®¤: 1, -1è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ)
- `--enable_grouping`: å¯ç”¨æ¨¡å¼åˆ†ç»„åŠŸèƒ½ï¼Œå‡å°‘è¾“å‡ºæ–‡ä»¶å¤§å°
- `--correlation_threshold`: åˆ†ç»„æ—¶çš„ç›¸ä¼¼æ€§é˜ˆå€¼ (é»˜è®¤: 0.9, èŒƒå›´: 0.0-1.0)


## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå•è‚¡å¼€ç›˜ä»·åˆ†æ

```bash
# åˆ†ææµ·æ³°å‘å±•å¼€ç›˜ä»·çš„5æ—¥çª—å£æ’åºæ¨¡å¼
python main.py --mode single --stock_file data_example/sh600082.csv --price_type open -w 5
```

é¢„æœŸè¾“å‡ºï¼š
```
=== å•è‚¡Kçº¿æ’åºåˆ†æ ===
è‚¡ç¥¨: sh600082 (N/A)
ä»·æ ¼ç±»å‹: å¼€ç›˜ä»·
æ—¶é—´çª—å£: 5
æ•°æ®èŒƒå›´: 1997-06-20 è‡³ 2025-06-20

æ­£åœ¨è®¡ç®—å¼€ç›˜ä»·æ’åºæ¨¡å¼...
æ‰¾åˆ°æ’åºæ¨¡å¼: 120 ç§å¯èƒ½
å®é™…å‡ºç°æ¨¡å¼: 0 ç§
é«˜é¢‘æ¨¡å¼ (â‰¥10æ¬¡): 0 ç§

ç”Ÿæˆåˆ†æè¡¨æ ¼...
ä¿å­˜ç»“æœ: output/single_stock/sh600082_open_w5.csv
åˆ†æå®Œæˆï¼
```

### ç¤ºä¾‹2ï¼šå•è‚¡æ”¶ç›˜ä»·åˆ†æ

```bash
# åˆ†ææ”¶ç›˜ä»·çš„5æ—¥çª—å£
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 5
```

å°†ç”Ÿæˆæ–‡ä»¶ï¼š`output/single_stock/sh600082_close_w5.csv`

### ç¤ºä¾‹3ï¼šæ‰¹é‡å¤„ç†ï¼ˆå…¨å¸‚åœºåˆ†æï¼‰

```bash
# æ‰¹é‡åˆ†ææ‰€æœ‰è‚¡ç¥¨çš„æœ€é«˜ä»·æ’åºæ¨¡å¼
python main.py --mode batch --data_dir data_example/ --price_type high -w 5
```

å°†ç”Ÿæˆæ–‡ä»¶ï¼š`output/market/market_high_w5.csv`

### ç¤ºä¾‹4ï¼šå¹¶è¡Œå¤„ç†åŠ é€Ÿ

```bash
# ä½¿ç”¨4ä¸ªCPUæ ¸å¿ƒå¹¶è¡Œå¤„ç†
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 10 -j 4

# ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒï¼ˆæ¨èï¼‰
python main.py --mode batch --data_dir data_example/ --price_type close -w 8 -j -1
```

### ç¤ºä¾‹5ï¼šæ¨¡å¼åˆ†ç»„å‡å°‘æ–‡ä»¶å¤§å°

```bash
# å¯ç”¨æ¨¡å¼åˆ†ç»„ï¼ˆæ¨èçª—å£é•¿åº¦>=8æ—¶ä½¿ç”¨ï¼‰
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 10 --enable_grouping

# è‡ªå®šä¹‰ç›¸ä¼¼æ€§é˜ˆå€¼ï¼ˆæ›´ä½é˜ˆå€¼=æ›´å¤šå‹ç¼©ï¼‰
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 12 --enable_grouping --correlation_threshold 0.8
```

### ç¤ºä¾‹6ï¼šæœ€ä½³æ€§èƒ½é…ç½®

```bash
# ç»¼åˆä½¿ç”¨å¹¶è¡Œå¤„ç†å’Œæ¨¡å¼åˆ†ç»„
python main.py --mode batch --data_dir data_example/ --price_type close -w 12 -j -1 --enable_grouping --correlation_threshold 0.9
```

### ç¤ºä¾‹7ï¼šè°ƒæ•´å‚æ•°

```bash
# é™ä½æœ€å°é¢‘ç‡é˜ˆå€¼ï¼Œåˆ†ææ›´å¤§çª—å£
python main.py --mode single --stock_file data_example/sh600082.csv --price_type open -w 10 --min_frequency 5
```

## æ•°æ®æ ¼å¼è¯´æ˜

### è¾“å…¥æ•°æ®æ ¼å¼

#### CSVæ ¼å¼ (ä¸­æ–‡åˆ—å)
æœ¬é¡¹ç›®æ”¯æŒåŒ…å«ä¸­æ–‡åˆ—åçš„Aè‚¡æ•°æ®CSVæ–‡ä»¶æ ¼å¼ï¼š

```csv
è‚¡ç¥¨ä»£ç ,è‚¡ç¥¨ç®€ç§°,äº¤æ˜“æ—¥æœŸ,å¼€ç›˜ä»·,æœ€é«˜ä»·,æœ€ä½ä»·,æ”¶ç›˜ä»·,å‰æ”¶ç›˜ä»·,æˆäº¤é‡,æˆäº¤é¢,æµé€šå¸‚å€¼,æ€»å¸‚å€¼
sh600082,æµ·æ³°å‘å±•,1997-06-20,10.2,11.09,9.7,10.9,5.18,20366800.0,211444048.0,327000000.0,1249140000.0
sh600082,æµ·æ³°å‘å±•,1997-06-23,10.85,10.9,9.82,10.1,10.9,8777300.0,90422378.0,303000000.0,1157460000.0
sh600082,æµ·æ³°å‘å±•,1997-06-24,10.07,10.26,9.78,9.9,10.1,4050400.0,40319176.0,297000000.0,1134540000.0
...
```

**å¿…éœ€åˆ—**:
- `äº¤æ˜“æ—¥æœŸ`: äº¤æ˜“æ—¥æœŸ (YYYY-MM-DD æ ¼å¼)
- `å¼€ç›˜ä»·`: å¼€ç›˜ä»·
- `æœ€é«˜ä»·`: æœ€é«˜ä»·
- `æœ€ä½ä»·`: æœ€ä½ä»·
- `æ”¶ç›˜ä»·`: æ”¶ç›˜ä»·

**å¯é€‰åˆ—**:
- `è‚¡ç¥¨ä»£ç `: è‚¡ç¥¨ä»£ç  (å¦‚sh600082)
- `è‚¡ç¥¨ç®€ç§°`: è‚¡ç¥¨åç§° (å¦‚æµ·æ³°å‘å±•)
- `æˆäº¤é‡`: æˆäº¤é‡ (æ‰‹)
- `æˆäº¤é¢`: æˆäº¤é‡‘é¢ (å…ƒ)
- å…¶ä»–åˆ—å°†è¢«å¿½ç•¥

**æ–‡ä»¶è¦æ±‚**:
- æ”¯æŒå¤šç§ç¼–ç æ ¼å¼ (UTF-8, GBK, GB2312ç­‰)
- è‡ªåŠ¨è·³è¿‡æ–‡ä»¶å¼€å¤´çš„è¯´æ˜è¡Œ
- æ•°æ®æŒ‰äº¤æ˜“æ—¥æœŸæ­£åºæ’åˆ—
- æ–‡ä»¶å‘½åæ ¼å¼ï¼š`{è‚¡ç¥¨ä»£ç }.csv` (å¦‚ï¼šsh600082.csv)

### è¾“å‡ºç»“æœæ ¼å¼

#### åˆ†æè¡¨æ ¼ç»“æ„ï¼ˆCSVæ ¼å¼ï¼‰

##### æ ‡å‡†è¾“å‡ºæ ¼å¼

æ¯ä¸ªåˆ†æç»“æœè¡¨æ ¼åŒ…å«ä»¥ä¸‹12åˆ—ï¼š

```csv
rank_pattern,return_1d_mean,return_1d_std,return_3d_mean,return_3d_std,return_5d_mean,return_5d_std,return_10d_mean,return_10d_std,return_20d_mean,return_20d_std,frequency
"(1, 2, 3, 4, 5)",-0.0006,0.0389,0.0024,0.0666,0.0018,0.0882,-0.0009,0.1091,0.0035,0.1615,411
"(5, 4, 3, 2, 1)",-0.0006,0.0332,0.0012,0.0549,0.0042,0.0835,0.0048,0.1167,0.0027,0.1650,282
"(1, 2, 3, 5, 4)",0.0021,0.0338,0.0014,0.0695,0.0033,0.0915,0.0068,0.1116,0.0076,0.1762,236
...
```

##### åˆ†ç»„è¾“å‡ºæ ¼å¼ï¼ˆå¯ç”¨--enable_groupingæ—¶ï¼‰

```csv
group_id,representative_pattern,pattern_count,return_1d_mean,return_1d_std,return_3d_mean,return_3d_std,return_5d_mean,return_5d_std,return_10d_mean,return_10d_std,return_20d_mean,return_20d_std,frequency
Group_0001,"(1, 2, 3, 4, 5)",5,-0.0006,0.0389,0.0024,0.0666,0.0018,0.0882,-0.0009,0.1091,0.0035,0.1615,2055
Group_0002,"(5, 4, 3, 2, 1)",3,-0.0006,0.0332,0.0012,0.0549,0.0042,0.0835,0.0048,0.1167,0.0027,0.1650,1410
...
```

**æ ‡å‡†æ ¼å¼åˆ—å®šä¹‰**:
1. `rank_pattern`: æ’åºæ¨¡å¼åˆ—è¡¨
2. `return_1d_mean`: æœªæ¥1å¤©å¹³å‡æ”¶ç›Šç‡
3. `return_1d_std`: æœªæ¥1å¤©æ”¶ç›Šç‡æ ‡å‡†å·®
4. `return_3d_mean`: æœªæ¥3å¤©å¹³å‡æ”¶ç›Šç‡
5. `return_3d_std`: æœªæ¥3å¤©æ”¶ç›Šç‡æ ‡å‡†å·®
6. `return_5d_mean`: æœªæ¥5å¤©å¹³å‡æ”¶ç›Šç‡
7. `return_5d_std`: æœªæ¥5å¤©æ”¶ç›Šç‡æ ‡å‡†å·®
8. `return_10d_mean`: æœªæ¥10å¤©å¹³å‡æ”¶ç›Šç‡
9. `return_10d_std`: æœªæ¥10å¤©æ”¶ç›Šç‡æ ‡å‡†å·®
10. `return_20d_mean`: æœªæ¥20å¤©å¹³å‡æ”¶ç›Šç‡
11. `return_20d_std`: æœªæ¥20å¤©æ”¶ç›Šç‡æ ‡å‡†å·®
12. `frequency`: è¯¥æ’åºæ¨¡å¼å‡ºç°æ¬¡æ•°

**åˆ†ç»„æ ¼å¼é¢å¤–åˆ—å®šä¹‰**:
- `group_id`: åˆ†ç»„å”¯ä¸€æ ‡è¯†ç¬¦
- `representative_pattern`: ä»£è¡¨è¯¥ç»„çš„æ¨¡å¼
- `pattern_count`: è¯¥ç»„åŒ…å«çš„æ¨¡å¼æ•°é‡
- å…¶ä»–åˆ—: ç»„å†…æ‰€æœ‰æ¨¡å¼çš„åˆå¹¶ç»Ÿè®¡æ•°æ®

#### æ–‡ä»¶å‘½åè§„åˆ™

**å•è‚¡åˆ†æ**:
- `{è‚¡ç¥¨ä»£ç }_{ä»·æ ¼ç±»å‹}_w{çª—å£é•¿åº¦}.csv`
- ç¤ºä¾‹ï¼š`sh600082_open_w10.csv`ã€`sh600082_close_w20.csv`

**æ‰¹é‡åˆ†æ**:
- `market_{ä»·æ ¼ç±»å‹}_w{çª—å£é•¿åº¦}.csv`
- ç¤ºä¾‹ï¼š`market_high_w15.csv`ã€`market_low_w30.csv`

#### è¾“å‡ºæ–‡ä»¶å¤¹ç»“æ„
```
output/
â”œâ”€â”€ single_stock/           # å•è‚¡åˆ†æç»“æœ
â”‚   â”œâ”€â”€ sh600082_open_w10.csv
â”‚   â”œâ”€â”€ sh600082_open_w20.csv
â”‚   â”œâ”€â”€ sh600082_high_w10.csv
â”‚   â””â”€â”€ ...
â””â”€â”€ market/                 # æ‰¹é‡åˆ†æç»“æœ
    â”œâ”€â”€ market_open_w10.csv
    â”œâ”€â”€ market_close_w20.csv
    â””â”€â”€ ...
```

## æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ

### å¹¶è¡Œå¤„ç†ä½¿ç”¨æŒ‡å—

#### ğŸš€ æ¨èé…ç½®
- **å°æ•°æ®é›†**: `-j 4` (ä½¿ç”¨4ä¸ªCPUæ ¸å¿ƒ)
- **å¤§æ•°æ®é›†**: `-j -1` (ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ)
- **å•è‚¡åˆ†æ**: çª—å£é•¿åº¦ >= 10 æ—¶å¹¶è¡Œå¤„ç†æ•ˆæœæ˜æ˜¾
- **æ‰¹é‡åˆ†æ**: å§‹ç»ˆå»ºè®®ä½¿ç”¨å¹¶è¡Œå¤„ç†

#### âš¡ æ€§èƒ½å¯¹æ¯”
```bash
# å•çº¿ç¨‹å¤„ç†ï¼ˆåŸºå‡†ï¼‰
time python main.py --mode batch --data_dir data_example/ --price_type close -w 10 -j 1

# å¤šçº¿ç¨‹å¤„ç†ï¼ˆæ¨èï¼‰
time python main.py --mode batch --data_dir data_example/ --price_type close -w 10 -j -1
```

### æ¨¡å¼åˆ†ç»„ä½¿ç”¨æŒ‡å—

#### ğŸ—œï¸ ä½•æ—¶ä½¿ç”¨æ¨¡å¼åˆ†ç»„
- **å¼ºçƒˆæ¨è**: çª—å£é•¿åº¦ >= 8
- **å¿…é¡»ä½¿ç”¨**: çª—å£é•¿åº¦ >= 12ï¼ˆå¦åˆ™æ–‡ä»¶å¯èƒ½è¿‡å¤§ï¼‰
- **æ‰¹é‡åˆ†æ**: å¤§æ•°æ®é›†æ—¶å»ºè®®å¯ç”¨

#### ğŸ“Š å‹ç¼©æ•ˆæœå¯¹æ¯”
| çª—å£é•¿åº¦ | åŸå§‹æ¨¡å¼æ•° | åˆ†ç»„åæ¨¡å¼æ•° | å‹ç¼©ç‡ |
|---------|-----------|-------------|--------|
| w=5     | 120       | 120         | 0%     |
| w=8     | 40,320    | 4,032       | 90%    |
| w=10    | 3,628,800 | 362,880     | 90%    |
| w=12    | 479,001,600 | 47,900,160 | 90%   |

#### ğŸ¯ ç›¸ä¼¼æ€§é˜ˆå€¼é€‰æ‹©
- **0.95**: æå…¶ä¸¥æ ¼ï¼Œå¾ˆå°‘åˆ†ç»„ï¼Œæ–‡ä»¶è¾ƒå¤§
- **0.9** (é»˜è®¤): å¹³è¡¡å‹ç¼©ç‡å’Œå‡†ç¡®æ€§
- **0.8**: è¾ƒé«˜å‹ç¼©ç‡ï¼Œé€‚åˆè¶…å¤§æ•°æ®é›†
- **0.5**: æœ€å¤§å‹ç¼©ç‡ï¼Œå¯èƒ½æŸå¤±ä¸€äº›ç»†èŠ‚

### å¤§æ•°æ®å¤„ç†ç­–ç•¥

#### ğŸ’¾ å†…å­˜ä¼˜åŒ–
```bash
# å¯¹äºè¶…å¤§çª—å£é•¿åº¦ï¼Œä½¿ç”¨é«˜é˜ˆå€¼åˆ†ç»„
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 15 --enable_grouping --correlation_threshold 0.95

# æ‰¹é‡å¤„ç†å¤§æ•°æ®é›†
python main.py --mode batch --data_dir data_example/ --price_type close -w 10 -j -1 --enable_grouping
```

#### ğŸ”§ æœ€ä½³æ€§èƒ½é…ç½®ç¤ºä¾‹
```bash
# å°çª—å£ (w=3-7): åŸºç¡€é…ç½®
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 5 -j 4

# ä¸­ç­‰çª—å£ (w=8-12): å¯ç”¨åˆ†ç»„
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 10 -j -1 --enable_grouping

# å¤§çª—å£ (w>=13): å…¨åŠŸèƒ½å¯ç”¨
python main.py --mode single --stock_file data_example/sh600082.csv --price_type close -w 15 -j -1 --enable_grouping --correlation_threshold 0.9
```

### æ•…éšœæ’é™¤

#### ğŸš¨ å¸¸è§é—®é¢˜
1. **å†…å­˜ä¸è¶³**: å¯ç”¨æ¨¡å¼åˆ†ç»„ `--enable_grouping`
2. **å¤„ç†é€Ÿåº¦æ…¢**: ä½¿ç”¨å¹¶è¡Œå¤„ç† `-j -1`
3. **æ–‡ä»¶è¿‡å¤§**: æé«˜ç›¸ä¼¼æ€§é˜ˆå€¼ `--correlation_threshold 0.95`
4. **åˆ†ç»„ç»“æœå¼‚å¸¸**: æ£€æŸ¥é˜ˆå€¼è®¾ç½®ï¼Œç¡®ä¿ä¸ä¼šå°†å®Œå…¨ä¸åŒçš„æ¨¡å¼åˆ†ç»„

#### âš ï¸ æ³¨æ„äº‹é¡¹
- å¹¶è¡Œå¤„ç†ç»“æœåº”ä¸å•çº¿ç¨‹å®Œå…¨ä¸€è‡´
- åˆ†ç»„åŠŸèƒ½ä¼šæ”¹å˜è¾“å‡ºæ ¼å¼ï¼Œæ³¨æ„åˆ—åå˜åŒ–
- è¶…å¤§çª—å£é•¿åº¦å¯èƒ½éœ€è¦å¤§é‡å†…å­˜å’Œæ—¶é—´
- å»ºè®®å…ˆåœ¨å°æ•°æ®é›†ä¸Šæµ‹è¯•å‚æ•°é…ç½®

### é¡¹ç›®ç»“æ„

```
similar_K/
â”œâ”€â”€ main.py                    # ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt           # ä¾èµ–åº“åˆ—è¡¨
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ CLAUDE.md                  # Claude Code æŒ‡å¯¼æ–‡æ¡£
â”œâ”€â”€ data_example/              # ç¤ºä¾‹æ•°æ®
â”‚   â””â”€â”€ sh600082.csv
â”œâ”€â”€ output/                    # è¾“å‡ºç»“æœç›®å½•
â”‚   â”œâ”€â”€ single_stock/          # å•è‚¡åˆ†æç»“æœ
â”‚   â””â”€â”€ market/                # æ‰¹é‡åˆ†æç»“æœ
â””â”€â”€ src/                       # æºä»£ç ç›®å½•
    â”œâ”€â”€ ranked_kline/          # æ ¸å¿ƒç®—æ³•æ¨¡å—
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â””â”€â”€ analyzer.py        # ä¸»è¦åˆ†æé€»è¾‘
    â””â”€â”€ utils/                 # å·¥å…·æ¨¡å—
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ cli_parser.py      # å‘½ä»¤è¡Œå‚æ•°è§£æ
        â”œâ”€â”€ data_loader.py     # æ•°æ®åŠ è½½å™¨
        â”œâ”€â”€ output_manager.py  # è¾“å‡ºç®¡ç†å™¨
        â””â”€â”€ pattern_grouper.py # æ¨¡å¼åˆ†ç»„å™¨ï¼ˆæ–°å¢ï¼‰
```

